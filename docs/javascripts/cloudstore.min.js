class CloudStore{constructor(t,e){this.server=e||"https://enjine.cloud/cloudstore",this.m_apiKey=t,this.m_maxRate=3e3,this.m_tlast=0,this.m_retry=!0}rateCheck(){var t=+new Date;return!(t-this.m_tlast<this.m_maxRate)&&(this.m_tlast=t,!0)}async sendData(t,e){try{if(void 0===t)return Promise.reject("url or options not defined");return void 0!==e&&void 0===e.method&&(e.method="POST"),(await fetch(t,e)).json()}catch(t){return console.error(t),{error:"Error sending data!"}}}save(t,e,r,s){try{if(!this.rateCheck())return void setTimeout(()=>{this.save(t,e,r,s)},this.m_maxRate+500);const a={key:this.m_apiKey,file:t,options:null,id:"_data",value:e,password:s},o=this.server+"/store/save",i={body:JSON.stringify(a),headers:{"Content-type":"application/json; charset=UTF-8"}};this.sendData(o,i).then(t=>{r&&r(t)})}catch(t){console.error(t),r&&r({error:"Error saving data!"})}}merge(t,e,r,s){try{if(!this.rateCheck())return void setTimeout(()=>{this.merge(t,e,r,s)},this.m_maxRate+500);const a={key:this.m_apiKey,file:t,options:"merge",id:"_data",value:e,password:s},o=this.server+"/store/save",i={body:JSON.stringify(a),headers:{"Content-type":"application/json; charset=UTF-8"}};this.sendData(o,i).then(t=>{r&&r(t)})}catch(t){console.error(t),r&&r({error:"Error merging data!"})}}delete(t,e,r){try{if(!this.rateCheck())return void setTimeout(()=>{this.delete(t,e,r)},this.m_maxRate+500);const s={key:this.m_apiKey,file:t,options:"delete",id:"_data",value:null,password:r},a=this.server+"/store/save",o={body:JSON.stringify(s),headers:{"Content-type":"application/json; charset=UTF-8"}};this.sendData(a,o).then(t=>{e&&e(t)})}catch(t){console.error(t),e&&e({error:"Error deleting data!"})}}load(t,e,r){try{if(!this.rateCheck())return void setTimeout(()=>{this.load(t,e,r)},this.m_maxRate+500);var s={key:this.m_apiKey,file:t,options:null,id:"_data",password:r};const a=this.server+"/store/load",o={body:JSON.stringify(s),headers:{"Content-type":"application/json; charset=UTF-8"}};this.sendData(a,o).then(t=>{t.data=t.message||"",e&&e(t)})}catch(t){console.error(t),e&&e({error:"Error loading data!"})}}list(t,e){try{if(!this.rateCheck())return void setTimeout(()=>{this.list(t,e)},this.m_maxRate+500);t||(t="");var r={key:this.m_apiKey,file:t,options:"list",id:"_data"};const s=this.server+"/store/load",a={body:JSON.stringify(r),headers:{"Content-type":"application/json; charset=UTF-8"}};this.sendData(s,a).then(t=>{t.data=t.message||"",e&&e(t)})}catch(t){console.error(t),e&&e({error:"Error listing data!"})}}upload(t,e,r,s,a){try{if(!this.rateCheck())return;var o=new FormData;const i="string"==typeof t?this.b64toBlob(t,e,r):t;o.append("file",i),o.append("key",this.m_apiKey),o.append("password",a);const n=this.server+"/upload-2",h={body:o};this.sendData(n,h).then(t=>{s&&s(t)})}catch(t){console.error(t),s&&s({error:"Error uploading the file!"})}}b64toBlob(t,e="",r="",s=512){try{const a=atob(t),o=[];for(let t=0;t<a.length;t+=s){const e=a.slice(t,t+s),r=new Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);const i=new Uint8Array(r);o.push(i)}return console.log(o),new File(o,e,{type:r})}catch(t){return console.error(t),""}}}